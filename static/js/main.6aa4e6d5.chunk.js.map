{"version":3,"sources":["cards.js","enemies.js","icons.js","orders.js","utils.js","Game.js","Card.js","Controller.js","Panel.js","TagSelection.js","DeckConstruction.js","tags.js","Board.js","App.js","serviceWorker.js","index.js"],"names":["CARDS","name","cost","atk","hp","mine","block","illust","desc","onMine","G","ctx","score","efield","length","idx","random","Die","deal_damage","ENEMIES","ICONS","alcohol","src","height","rma","rock","d32","order_illust","material_icons","ORDERS","requirements","reward","effect","payMaterials","gainMaterials","materials","onTurnBegin","map_object","fn","obj","new_obj","k","move","d1","d2","cd_idx","card","splice","push","count","cnt","gained","i","material","delta","logMsg","use","exhausted","deck","dmg","draw","drawOrder","odeck","drawEnemy","edeck","enemy","onPlay","msg","messages","unshift","AC","setup","get_enemies","map","x","Object","assign","Shuffle","concat","discard","ediscard","orders","finished","costs","danger","goal","max_danger","exhausted_enter","playing","moves","setDeck","deck_data","card_dict","arr","item","arr2obj","cards","split","card_data","amount","parseInt","target_card","addTags","tags","onScenarioBegin","console","log","events","endTurn","play","hand","payCost","field","setValue","attr","val","finishOrder","order","useOrder","fight","idx1","idx2","enemyMove","blocker","blocked_enemies","c","get_blocker","blocker_idx","indexOf","changeMsg","turn","onBegin","refresh","endIf","win","reason","Card","props","additional_styles","e_illust","o_illust","cardState","border","selected","damaged","color","className","onClick","handleClick","keys","data","variant","value","additionalStyle","Data","is_img","includes","img_tag","style","CardRow","states","CardDetailed","align","Controller","actions","action","EnterGame","switchScene","switchText","enterGame","Panel","content","TagSelection","tbody","row","row_tags","slice","tag","borderColor","TagList","marginLeft","marginTop","selected_tags","RiskLevel","risk_level","DeckConstruction","onChange","handleChange","rows","columns","TAGS","tag_list","t","level","process_tags","Board","handle_hand_clicked","bind","handle_field_clicked","handle_efield_clicked","handle_order_clicked","handle_finished_clicked","handle_deck_change","enemy_move","process_hand_data","process_hand_state","process_field_data","process_field_state","process_efield_data","process_efield_state","process_order_data","process_order_state","process_finished_data","process_finished_state","process_card_details","process_enemy_details","process_order_details","wrap_controller_action","set_branch","check_card","play_card","use_mine","use_fight","finish_order","use_order","render_game_board","render_tag_board","render_deck_board","render_card_board","change_board","choose_tag","get_risk_level","enter_game","state","hand_selected","field_selected","efield_selected","order_selected","finished_selected","branch","show_field","show_tag_selection","stage","board","checking","scenario_finished","branches","部署","查看","采掘","战斗","完成","行动","log_select","new_tags","setState","this","filter","reduce","acc","icon","j","order_effect","finished_effect","illust_detailed","cost_detailed","eo_illust_detailed","ms","sleep_time","Promise","resolve","setTimeout","then","event","target","new_board","boards","reset","result","gameover","grade","alert","player_panel","display","end_game","game_panel","join","field_cardrow","hand_cardrow","orders_cardrow","finished_cardrow","React","Component","App","Client","game","debug","Boolean","window","location","hostname","match","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.6aa4e6d5.chunk.js","sourcesContent":["import { deal_damage } from './Game';\n\nexport var CARDS = [\n  {\n    name: \"克洛丝\",\n    cost: 1,\n    atk: 3,\n    hp: 1,\n    mine: 1,\n    block: 0,\n    illust: \"http://ak.mooncell.wiki/images/b/ba/%E7%AB%8B%E7%BB%98_%E5%85%8B%E6%B4%9B%E4%B8%9D_1.png\",\n  },\n\n  {\n    name: \"阿米娅\",\n    cost: 3,\n    atk: 4,\n    hp: 2,\n    mine: 2,\n    block: 0,\n    illust: \"http://ak.mooncell.wiki/images/d/dd/%E7%AB%8B%E7%BB%98_%E9%98%BF%E7%B1%B3%E5%A8%85_1.png\",\n    desc: \"采掘: 获得1分\",\n    onMine(G, ctx) {\n      G.score += 1;\n    }\n  },\n\n  {\n    name: \"杰西卡\",\n    cost: 3,\n    atk: 5,\n    hp: 2,\n    mine: 1,\n    block: 0,\n    illust: \"http://ak.mooncell.wiki/images/9/96/%E7%AB%8B%E7%BB%98_%E6%9D%B0%E8%A5%BF%E5%8D%A1_1.png\",\n    desc: \"采掘: 造成3点伤害\",\n    onMine(G, ctx) {\n      if (G.efield.length > 0){\n        let idx = ctx.random.Die(G.efield.length) - 1\n        deal_damage(G, ctx, \"efield\", idx, 3);\n      }\n    }\n  },\n\n  {\n    name: \"玫兰莎\",\n    cost: 2,\n    atk: 2,\n    hp: 3,\n    mine: 1,\n    block: 1,\n    illust: \"http://ak.mooncell.wiki/images/0/09/%E7%AB%8B%E7%BB%98_%E7%8E%AB%E5%85%B0%E8%8E%8E_1.png\",\n  },\n\n  {\n    name: \"米格鲁\",\n    cost: 2,\n    atk: 0,\n    hp: 5,\n    mine: 1,\n    block: 2,\n    illust: \"http://ak.mooncell.wiki/images/4/44/%E7%AB%8B%E7%BB%98_%E7%B1%B3%E6%A0%BC%E9%B2%81_1.png\",\n  },\n\n  {\n    name: \"史都华德\",\n    cost: 2,\n    atk: 2,\n    hp: 2,\n    mine: 2,\n    block: 0,\n    illust: \"http://ak.mooncell.wiki/images/4/44/%E7%AB%8B%E7%BB%98_%E5%8F%B2%E9%83%BD%E5%8D%8E%E5%BE%B7_1.png\",\n  },\n\n  {\n    name: \"12F\",\n    cost: 6,\n    atk: 6,\n    hp: 4,\n    mine: 5,\n    block: 0,\n    illust: \"http://ak.mooncell.wiki/images/6/61/%E7%AB%8B%E7%BB%98_12F_1.png\",\n  },\n\n  {\n    name: \"黑角\",\n    cost: 8,\n    atk: 8,\n    hp: 8,\n    mine: 4,\n    block: 2,\n    illust: \"http://ak.mooncell.wiki/images/d/dc/%E7%AB%8B%E7%BB%98_%E9%BB%91%E8%A7%92_1.png\",\n  },\n\n  {\n    name: \"巡林者\",\n    cost: 5,\n    atk: 8,\n    hp: 4,\n    mine: 3,\n    block: 0,\n    illust: \"http://ak.mooncell.wiki/images/c/c8/%E7%AB%8B%E7%BB%98_%E5%B7%A1%E6%9E%97%E8%80%85_1.png\",\n  },\n\n];\n\nexport const default_deck = \"2 克洛丝\\n2 玫兰莎\\n2 米格鲁\\n2 史都华德\\n2 12F\\n2 巡林者\\n2 黑角\\n2 阿米娅\\n2 杰西卡\\n\";","export var ENEMIES = [\n  {\n    name: \"小兵\",\n    atk: 2,\n    hp: 3,\n    illust: \"http://ak.mooncell.wiki/images/3/34/%E5%A4%B4%E5%83%8F_%E6%95%8C%E4%BA%BA_%E5%A3%AB%E5%85%B5.png\",\n  },\n  {\n    name: \"猎犬\",\n    atk: 2,\n    hp: 2,\n    illust: \"http://ak.mooncell.wiki/images/3/3f/%E5%A4%B4%E5%83%8F_%E6%95%8C%E4%BA%BA_%E7%8C%8E%E7%8B%97.png\",\n  },\n  {\n    name: \"源石虫\",\n    atk: 1,\n    hp: 1,\n    illust: \"http://ak.mooncell.wiki/images/3/3e/%E5%A4%B4%E5%83%8F_%E6%95%8C%E4%BA%BA_%E6%BA%90%E7%9F%B3%E8%99%AB.png\",\n  },\n  {\n    name: \"重装\",\n    atk: 4,\n    hp: 6,\n    illust: \"http://ak.mooncell.wiki/images/f/f0/%E5%A4%B4%E5%83%8F_%E6%95%8C%E4%BA%BA_%E9%87%8D%E8%A3%85%E9%98%B2%E5%BE%A1%E8%80%85.png\",\n  },\n  {\n    name: \"破阵者\",\n    atk: 3,\n    hp: 2,\n    illust: \"http://ak.mooncell.wiki/images/f/f2/%E5%A4%B4%E5%83%8F_%E6%95%8C%E4%BA%BA_%E7%A0%B4%E9%98%B5%E8%80%85.png\",\n  },\n\n];","import React from 'react';\nconst icon_height = \"25em\";\nconst attr_icon_height = \"20em\";\n\nexport const ICONS = {\n  alcohol: (<img src=\"http://ak.mooncell.wiki/images/a/a8/%E9%81%93%E5%85%B7_%E5%B8%A6%E6%A1%86_%E6%89%AD%E8%BD%AC%E9%86%87.png\" height={icon_height} />),\n\n  rma: (<img src=\"http://ak.mooncell.wiki/images/7/7c/%E9%81%93%E5%85%B7_%E5%B8%A6%E6%A1%86_RMA70-12.png\" height={icon_height} />),\n\n  rock: (<img src=\"http://ak.mooncell.wiki/images/e/e7/%E9%81%93%E5%85%B7_%E5%B8%A6%E6%A1%86_%E7%A0%94%E7%A3%A8%E7%9F%B3.png\" height={icon_height} />),\n\n  d32: (<img src=\"http://ak.mooncell.wiki/images/7/76/%E9%81%93%E5%85%B7_%E5%B8%A6%E6%A1%86_D32%E9%92%A2.png\" height={icon_height} />),\n\n  mine: (<img src=\"https://dss1.bdstatic.com/6OF1bjeh1BF3odCf/it/u=1672017263,313384077&fm=74&app=80&f=JPEG&size=f121,121?sec=1880279984&t=807e81fe43f1078031ace9ef194ff68a\" height={attr_icon_height} />),\n\n  block: (<img src=\"http://img5.imgtn.bdimg.com/it/u=1153648212,1889048357&fm=26&gp=0.jpg\" height={attr_icon_height} />),\n\n}","import React from 'react';\nimport { gainMaterials, payMaterials } from './Game';\nimport { ICONS } from './icons';\n\nexport const order_illust = \"https://ak.hypergryph.com/assets/index/images/ak/common/story/item_mortal_city.png\";\n\nexport const material_icons = [ICONS.alcohol, ICONS.rma, ICONS.rock, ICONS.d32];\n\nexport const ORDERS = [\n  {\n    requirements: [3,0,0,0],\n    score: 2,\n    reward: 1,\n    desc: (<span>{material_icons[2]} → ? + ?</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [0,0,1,0])) {\n        gainMaterials(G, ctx, 2);\n      }\n    },\n  },\n  {\n    requirements: [0,3,0,0],\n    score: 2,\n    reward: 2,\n    desc: (<span>{material_icons[0]} → ? + ?</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [1,0,0,0])) {\n        gainMaterials(G, ctx, 2);\n      }\n    },\n\n  },\n  {\n    requirements: [0,0,3,0],\n    score: 2,\n    reward: 0,\n    desc: (<span>{material_icons[1]} → ? + ?</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [0,1,0,0])) {\n        gainMaterials(G, ctx, 2);\n      }\n    },\n  },\n\n  {\n    requirements: [3,0,0,0],\n    score: 2,\n    reward: 2,\n    desc: (<span>{material_icons[1]} → {material_icons[3]}</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [0,1,0,0])) {\n        G.materials[3] += 1;\n      }\n    },\n  },\n  {\n    requirements: [0,3,0,0],\n    score: 2,\n    reward: 0,\n    desc: (<span>{material_icons[2]} → {material_icons[3]}</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [0,0,1,0])) {\n        G.materials[3] += 1;\n      }\n    },\n\n  },\n  {\n    requirements: [0,0,3,0],\n    score: 2,\n    reward: 1,\n    desc: (<span>{material_icons[0]} → {material_icons[3]}</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [1,0,0,0])) {\n        G.materials[3] += 1;\n      }\n    },\n  },\n\n  {\n    requirements: [3,0,0,0],\n    score: 2,\n    reward: 1,\n    desc: (<span>{material_icons[2]} → 2分</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [0,0,1,0])) {\n        G.score += 2;\n      }\n    },\n  },\n  {\n    requirements: [0,3,0,0],\n    score: 2,\n    reward: 2,\n    desc: (<span>{material_icons[0]} → 2分</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [1,0,0,0])) {\n        G.score += 2;\n      }\n    },\n\n  },\n  {\n    requirements: [0,0,3,0],\n    score: 2,\n    reward: 0,\n    desc: (<span>{material_icons[1]} → 2分</span>),\n    effect(G, ctx) {\n      if (payMaterials(G, ctx, [0,1,0,0])) {\n        G.score += 2;\n      }\n    },\n  },\n  \n  {\n    requirements: [3,0,0,0],\n    score: 2,\n    reward: 2,\n    desc: (<span>收入: {material_icons[1]}</span>),\n    onTurnBegin(G, ctx) {\n      G.materials[1] += 1;\n    },\n  },\n\n  {\n    requirements: [0,3,0,0],\n    score: 2,\n    reward: 0,\n    desc: (<span>收入: {material_icons[2]}</span>),\n    onTurnBegin(G, ctx) {\n      G.materials[2] += 1;\n    },\n  },\n\n  {\n    requirements: [0,0,3,0],\n    score: 2,\n    reward: 1,\n    desc: (<span>收入: {material_icons[0]}</span>),\n    onTurnBegin(G, ctx) {\n      G.materials[0] += 1;\n    },\n  },\n\n];","export function map_object(fn, obj) {\n  let new_obj = {};\n\n  for (let k in obj) {\n    new_obj[k] = fn(obj[k], k);\n  }\n\n  return new_obj;\n}\n\nexport function sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport function arr2obj(arr) {\n  let new_obj = {};\n\n  for (let item of arr) {\n    new_obj[item.name] = item;\n  }\n\n  return new_obj;\n}","import { React } from 'react';\nimport { CARDS } from \"./cards\";\nimport { ENEMIES } from \"./enemies\";\nimport { ORDERS, material_icons } from \"./orders\";\nimport { arr2obj } from \"./utils\";\n\nfunction move(G, ctx, d1, d2, idx) {\n  let cd_idx = idx || 0;\n  let card = G[d1].splice(cd_idx, 1)[0];\n  G[d2].push(card);\n  return card;\n}\n\nfunction payCost(G, ctx, cost) {\n  if (G.costs >= cost) {\n    G.costs -= cost\n    return true;\n  }\n\n  else{\n    logMsg(G, ctx, \"费用不足\");\n    return false;\n  }\n}\n\nfunction gainMaterials(G, ctx, count) {\n  let cnt = count || 1;\n  let gained = [];\n\n  for (let i=0; i<cnt; i++) {\n    let material = ctx.random.Die(3)-1;\n    G.materials[material] += 1; //TODO: add this to log\n    gained.push(material);\n  }\n\n  G.gained = gained;\n}\n\nfunction payMaterials(G, ctx, requirements) {\n  let delta = 0;\n  for (let i=0; i<4; i++) {\n    if (G.materials[i] < requirements[i]) {\n      delta += requirements[i] - G.materials[i];\n    }\n  }\n\n  if (G.materials[3] < delta) {\n    logMsg(G, ctx, \"材料不足\");\n    return false;\n  }\n\n  else {\n    for (let i=0; i<4; i++) {\n      G.materials[i] -= requirements[i];\n\n      if (G.materials[i] < 0) {\n        G.materials[3] += G.materials[i]; //add a negative num is reduce\n        G.materials[i] = 0;\n      }\n    }\n\n    G.gained = [];\n\n    return true;\n  }\n}\n\nfunction use(G, ctx, card) {\n  if (!card.exhausted) {\n    card.exhausted = true;\n    return true;\n  }\n\n  else {\n    return false;\n  }\n}\n\nfunction get_blocker(G, ctx, idx) {\n  //Return who blocks this enemy\n  let blocked_enemies = 0;\n\n  for (let c of G.field) {\n    blocked_enemies += c.block || 0;\n    if (blocked_enemies > idx) {\n      return c;\n    }\n  }\n\n  return false;\n}\n\nexport function deal_damage(G, ctx, deck, idx, dmg) {\n  let card = G[deck][idx];\n\n  //cards with no damage may not have the damage attr\n  card.dmg = card.dmg || 0;\n  card.dmg += dmg;\n  logMsg(G, ctx, `${card.name} 受到${dmg}点伤害`);\n\n  if (card.dmg >= card.hp) {\n    let discard = (deck == \"field\") ? \"discard\" : \"ediscard\";\n    move(G, ctx, deck, discard, idx);\n    logMsg(G, ctx, `${card.name} 被摧毁`);\n  }\n}\n\nfunction addTags(G, ctx, tags) {\n  for (let t of tags) {\n    t.effect(G, ctx);\n  }\n}\n\nfunction draw(G, ctx) {\n  if (G.deck.length > 0) {\n    move(G, ctx, \"deck\", \"hand\");\n  } //TODO: else, lose the game\n}\n\nfunction play(G, ctx, idx) {\n  let card = G.hand[idx]; //No need to verify at this stage\n\n  if (payCost(G, ctx, card.cost)) {\n    move(G, ctx, \"hand\", \"field\", idx);\n    card.dmg = 0;\n    card.exhausted = G.exhausted_enter;\n    logMsg(G, ctx, `部署 ${card.name}`);\n    //TODO: if this is a spell instead of creature\n    //TODO: onPlay\n    if (card.onPlay) {\n      card.onPlay(G, ctx, card);\n    }\n  }\n}\n\nfunction mine(G, ctx, idx) {\n  let card = G.field[idx];\n\n  if (use(G, ctx, card)) {\n    gainMaterials(G, ctx, card.mine);\n    logMsg(G, ctx, `使用 ${card.name} 采掘`);\n    if (card.onMine) {\n      card.onMine(G, ctx, card);\n    }\n  }\n}\n\nfunction setValue(G, ctx, attr, val) {\n  G[attr] = val;\n}\n\nfunction drawOrder(G, ctx) {\n  if (G.odeck.length > 0) {\n    move(G, ctx, \"odeck\", \"orders\");\n  }\n}\n\nfunction finishOrder(G, ctx, idx) {\n  let order = G.orders[idx];\n\n  if (payMaterials(G, ctx, order.requirements)) {\n    G.materials[order.reward] += 1;\n    G.score += order.score;\n    G.finished.push(G.orders.splice(idx, 1)[0]);\n    logMsg(G, ctx, \"完成订单\");\n  }\n}\n\nfunction useOrder(G, ctx, idx) {\n  let order = G.finished[idx];\n\n  if (use(G, ctx, order)) {\n    order.effect(G, ctx);\n  }\n}\n\nfunction drawEnemy(G, ctx) {\n  if (G.edeck.length > 0) {\n    let enemy = move(G, ctx, \"edeck\", \"efield\");\n    enemy.exhausted = true;\n    enemy.dmg = 0;\n    logMsg(G, ctx, `${enemy.name} 入场`);\n    if (enemy.onPlay) {\n      enemy.onPlay(G, ctx, enemy);\n    }\n  }\n}\n\nfunction fight(G, ctx, idx1, idx2) {\n  if (idx1 < 0 || idx1 >= G.field.length || idx2 < 0 || idx2 >= G.efield.length) {\n    console.log(\"invalid move\");\n    return;\n  }\n\n  let card = G.field[idx1];\n  let enemy = G.efield[idx2];\n\n  if (use(G, ctx, card)) {\n    logMsg(G, ctx, `使用 ${card.name} 战斗`);\n    deal_damage(G, ctx, \"efield\", idx2, card.atk);\n  }\n}\n\nfunction enemyMove(G, ctx, idx) {\n  let enemy = G.efield[idx];\n\n  if (use(G, ctx, enemy)) {\n    let blocker = get_blocker(G, ctx, idx);\n    let blocker_idx = G.field.indexOf(blocker);\n\n    if (blocker) {\n      deal_damage(G, ctx, \"field\", blocker_idx, enemy.atk);\n      logMsg(G, ctx, `${enemy.name} 对 ${blocker.name} 发起了进攻`);\n    }\n\n    else {\n      G.danger += 1;\n      logMsg(G, ctx, `${enemy.name} 发起了动乱`);\n    }\n  }\n}\n\nfunction refresh(G, ctx) {\n  for (let card of [].concat(G.field, G.efield, G.finished)) {\n      card.exhausted = false;\n  }\n}\n\nfunction onScenarioBegin(G, ctx) {\n  //SetUp\n  for (let i=0; i<4; i++){\n    draw(G, ctx);\n  }\n\n  for (let i=0; i<2; i++){\n    drawEnemy(G, ctx);\n  }\n\n  for (let i=0; i<3; i++){\n    drawOrder(G, ctx);\n  }\n  console.log(\"Setup finished\");\n  G.playing = true;\n  ctx.events.endTurn();\n}\n\nfunction setDeck(G, ctx, deck_data) {\n  let card_dict = arr2obj(CARDS);\n  let deck = [];\n\n  let cards = deck_data.split(\"\\n\");\n  for (let card of cards) {\n    let card_data = card.split(\" \");\n    if (card_data.length >= 2) {\n      let amount = parseInt(card_data[0]) || 0; // If it's NaN, then assign it 0\n      let target_card = card_dict[card_data[1]];\n      if (target_card) {\n        for (let i=0; i<amount; i++) {\n            deck.push(Object.assign({}, target_card));\n        }\n      }\n    }\n  }\n  G.deck = ctx.random.Shuffle(deck);\n}\n\nfunction logMsg(G, ctx, msg) {\n  G.messages.unshift(msg);\n}\n\nfunction changeMsg(G, ctx, msg) {\n  G.messages[0] = msg;\n}\n\nexport const AC = {\n  setup(ctx) {\n    const G = {};\n\n    G.hand = [];\n    G.field = [];\n\n    G.deck = [];\n    let get_enemies = () => (ENEMIES.map(x=>Object.assign({},x)));\n    G.edeck = ctx.random.Shuffle(get_enemies().concat(get_enemies()));\n    G.odeck = ctx.random.Shuffle(ORDERS.map(x=>Object.assign({},x)));\n    \n    G.efield = [];\n    G.discard = [];\n    G.ediscard = [];\n\n    G.orders = [];\n    G.finished = [];\n\n    G.costs = 2; //On turn begin, gain 3, so it's 2 at setup\n    G.materials = [0, 0, 0, 0]; //EH: it may not be a good idea to set materials in array, but whatever, do it at first\n\n    G.score = 0;\n    G.danger = 0;\n    G.goal = 10;\n    G.max_danger = 8;\n\n    G.exhausted_enter = false;\n\n    G.messages = [\"欢迎来到明日方舟: 采掘行动\"];\n\n    G.playing = false;\n    G.gained = [];\n\n    return G;\n  },\n\n  moves: {\n    setDeck,\n    addTags,\n    onScenarioBegin,\n    draw,\n    play,\n    mine,\n    setValue,\n    drawOrder,\n    finishOrder,\n    useOrder,\n    drawEnemy,\n    fight,\n    enemyMove,\n    logMsg,\n    changeMsg,\n  },\n\n  turn: {\n    onBegin(G, ctx) {\n        if (G.playing) {\n          console.log(\"On turn begin\");\n          logMsg(G, ctx, \"回合开始\");\n          refresh(G, ctx);\n          draw(G, ctx);\n          drawOrder(G, ctx);\n          G.costs += 3;\n      }\n    },\n  },\n\n  endIf(G, ctx) {\n    if (G.playing) {\n      if (G.deck.length == 0) {\n        return {\n          win: false,\n          reason: \"牌库被抽光\",\n        };\n      }\n      else if (G.edeck.length == 0) {\n        return {\n          win: false,\n          reason: \"敌人牌库被抽光\",\n        }\n      }\n      else if (G.danger >= G.max_danger) {\n        return {\n          win: false,\n          reason: \"动乱指数过高\",\n        }\n      }\n      else if (G.score >= G.goal) {\n        return {\n          win: true,\n        }\n      }\n    }\n  }\n  \n\n  // TODO: know how to set available moves to all moves, then add this phase feature\n  // phases: {\n  //   // TODO: set available moves on phases\n  //   preScenario: {\n  //     start: true,\n  //     next: \"scenario\",\n  //     onEnd(G, ctx) {\n  //       console.log(\"Scenario setup finished, enter the game\");\n  //     }\n  //   },\n\n  //   scenario: {\n  //     turn: {\n  //       onBegin(G, ctx) {\n  //         console.log(\"On turn begin\");\n  //         refresh(G, ctx);\n  //         draw(G, ctx);\n  //         G.costs += 3;\n  //       },\n\n  //     },\n\n  //   }\n  // },\n\n};\n\nexport { gainMaterials, payMaterials };","import React from 'react';\nimport './Card.css';\n\nexport const Card = (props) => {\n  let additional_styles = {\n    illust: {},\n    e_illust: {},\n    o_illust: {},\n    hp: {},\n  };\n\n  if (props.cardState.exhausted) {\n    let exhausted_border = \"1px solid red\";\n    additional_styles.illust.border = exhausted_border;\n    additional_styles.e_illust.border = exhausted_border;\n    additional_styles.o_illust.border = exhausted_border;\n    //EH: reconstruct this part\n  }\n  if (props.cardState.selected) {\n    if (props.cardState.exhausted) {\n      let selected_exhausted_border = \"3px solid purple\";\n      additional_styles.illust.border = selected_exhausted_border;\n      additional_styles.e_illust.border = selected_exhausted_border;\n      additional_styles.o_illust.border = selected_exhausted_border;\n\n    }\n    else {\n      let selected_border = \"3px solid blue\";\n      additional_styles.illust.border = selected_border;\n      additional_styles.e_illust.border = selected_border;\n      additional_styles.o_illust.border = selected_border;\n    }\n  };\n  if (props.cardState.damaged) { \n    additional_styles.hp.color = \"red\";\n    //EH: only font change color and border does not change, are there parameters like that? I've searched through the parameters and did not find such one.\n  }\n\n  return (\n    <div\n      className=\"card\"\n      onClick = {props.handleClick}\n    >\n      {Object.keys(props.data).map((variant) => (\n        <Data\n          variant = {variant}\n          value = {props.data[variant]}\n          additionalStyle = {additional_styles[variant]}\n        />\n      ))}\n    </div>\n\n  );\n};\n\nexport const Data = (props) => {\n  let is_img = props.variant.includes(\"illust\");\n  let img_tag = (\n    <img\n        className = {props.variant}\n        src = {props.value}\n    />\n  );\n\n  return (\n    <div\n      className = {\"data \"+props.variant}\n      style = {props.additionalStyle}\n    >\n      {(is_img) ? img_tag : props.value}\n    </div>\n  );\n}\n\nexport const CardRow = (props) => {\n  return (\n    <div className=\"card-row\">\n      {props.cards.map((card, idx) => (\n        <Card\n          data={card}\n          cardState = {props.states[idx]}\n          handleClick={(props.handleClick)? (props.handleClick(idx)) : null} \n        />\n      ))}\n    </div>\n  );\n}\n\nexport const CardDetailed = (props) => {\n  return (\n    <div className=\"card-board\" align=\"center\">\n      <div className=\"card-detailed\">\n      {Object.keys(props.card).map((variant) => (\n        <Data\n          variant = {variant}\n          value = {props.card[variant]}\n        />\n      ))}\n      </div>\n      <button className=\"card-detailed-button\" onClick={props.handleClick}>完成查看</button>\n    </div>\n  )\n}","import React from 'react';\nimport './Controller.css';\n\n//TODO: reconstruct the controller\nexport const Controller = (props) => {\n  return (\n    <div className=\"controller\" >\n      {Object.keys(props.actions).map(\n        (action) => (\n          <button onClick={props.actions[action]} className=\"controller-button\" >{action}</button>\n        )\n      )}\n    </div>\n  );\n};\n\nexport const EnterGame = (props) => {\n  return (\n    <div className=\"enter-game\" >\n      <button\n        className = \"enter-game\"\n        onClick = {props.switchScene}\n      >\n        {props.switchText}\n      </button>\n      <button\n        className = \"enter-game\"\n        onClick = {props.enterGame}\n      >\n        进入游戏\n      </button>\n    </div>\n  );\n};","import React from 'react';\nimport './Panel.css';\n\nexport const Panel = (props) => {\n  return (<div className={props.variant}>\n    {props.content}\n  </div>);\n};","import React from 'react';\nimport './TagSelection.css';\n\nexport const TagSelection = (props) => {\n  let tbody = [];\n\n  for (let i=0; i<props.tags.length; i+=3) {\n    let row = [];\n    let row_tags = props.tags.slice(i, i+3);\n    for (let tag of row_tags) {\n      row.push(\n        <td \n          className=\"tag\" \n          \n          onClick={props.handleClick(props.tags.indexOf(tag))}\n        >\n          <img \n            className=\"tag\" \n            src={tag.src}\n            style={{\n            borderColor: (tag.selected)? \"red\":\"black\"\n          }} \n          ></img>\n        </td>\n      );\n    }\n    tbody.push(<tr>{row}</tr>);\n  }\n\n  return (\n    <div className=\"tag-selection\" >\n      <table>\n        <tbody>{tbody}</tbody>\n      </table>\n    </div>\n  );\n};\n\nexport const TagList = (props) => {\n  return (\n    <div className=\"tag-list\" >\n      <ul\n        style = {{\n          marginLeft: \"-6%\",\n          marginTop: \"1%\",\n        }}\n      >\n        {props.selected_tags.map((tag) => (<li className=\"tag-desc\">{tag.desc}</li>))}\n      </ul>\n    </div>\n  );\n};\n\nexport const RiskLevel = (props) => {\n  return (\n    <div className=\"risk-level\" >\n      危机等级:<br/>\n      <span className=\"risk-level-value\">{props.risk_level}</span>\n    </div>\n  );\n}","import React from 'react';\nimport './DeckConstruction.css';\n\nexport const DeckConstruction = (props) => {\n  return (\n    <div className=\"deck-construction\" >\n      <form>\n        <textarea \n          value={props.value} \n          onChange={props.handleChange} \n          className=\"deck-construction\" \n          rows={25}\n          columns={20}\n        />\n      </form>\n    </div>\n  );\n};","const tag_list = [\n  {\n    src: \"http://ak.mooncell.wiki/images/d/d3/Enemy_def_1.png\",\n    desc: \"胜利所需的分数+2\",\n    level: 1,\n    effect(G, ctx) {\n      G.goal += 2;\n    }\n  },\n  {\n    src: \"http://ak.mooncell.wiki/images/a/a6/Global_lifepoint_1.png\",\n    desc: \"我方可承受的动乱指数-2\",\n    level: 1,\n    effect(G, ctx) {\n      G.max_danger -= 2;\n    }\n  },\n  {\n    src: \"http://ak.mooncell.wiki/images/5/5a/Enemy_atk_1.png\",\n    desc: \"所有敌人获得+2攻击力\",\n    level: 1,\n    effect(G, ctx) {\n      for (let enemy of G.edeck) {\n        enemy.atk += 2;\n      }\n    }\n  },\n  {\n    src: \"http://ak.mooncell.wiki/images/4/4e/Enemy_hp_1.png\",\n    desc: \"所有敌人获得+2生命值\",\n    level: 1,\n    effect(G, ctx) {\n      for (let enemy of G.edeck) {\n        enemy.hp += 2;\n      }\n    }\n  },\n  {\n    src: \"http://ak.mooncell.wiki/images/f/f7/Enemy_movespeed_1.png\",\n    desc: \"干员以横置状态入场\",\n    level: 2,\n    effect(G, ctx){\n      G.exhausted_enter = true;\n    }\n  },\n\n];\n\nfunction process_tags(tag_list) {\n  let tags = [];\n\n  for (let t of tag_list) {\n    t.selected = false;\n\n    if (t.level == 1) {\n      for (let i=0; i<3; i++) {\n        tags.push(Object.assign({}, t)); // EH: maybe this can be reconstructed to one line instead of for loop\n      }\n    }\n    else {\n      tags.push(Object.assign({}, t));\n    }\n  }\n\n  return tags;\n}\n\nexport const TAGS = process_tags(tag_list);","import React from 'react';\nimport { Card, CardRow, CardDetailed } from './Card';\nimport { Controller, EnterGame } from './Controller';\nimport { Panel } from './Panel';\nimport { TagSelection, TagList, RiskLevel } from './TagSelection';\nimport { DeckConstruction } from './DeckConstruction';\nimport { map_object, sleep } from './utils';\nimport { CARDS, default_deck } from './cards';\nimport { order_illust, material_icons } from './orders';\nimport { ICONS } from './icons';\nimport { TAGS } from './tags';\n\nimport './Board.css';\n\nexport class Board extends React.Component {\n\n  constructor(props){\n    super(props);\n\n    this.handle_hand_clicked = this.handle_hand_clicked.bind(this);\n    this.handle_field_clicked = this.handle_field_clicked.bind(this);\n    this.handle_efield_clicked = this.handle_efield_clicked.bind(this);\n    this.handle_order_clicked = this.handle_order_clicked.bind(this);\n    this.handle_finished_clicked = this.handle_finished_clicked.bind(this);\n    this.handle_deck_change = this.handle_deck_change.bind(this);\n\n    this.enemy_move = this.enemy_move.bind(this);\n\n    this.process_hand_data = this.process_hand_data.bind(this);\n    this.process_hand_state = this.process_hand_state.bind(this);\n    this.process_field_data = this.process_field_data.bind(this);\n    this.process_field_state = this.process_field_state.bind(this);\n    this.process_efield_data = this.process_efield_data.bind(this);\n    this.process_efield_state = this.process_efield_state.bind(this);\n    this.process_order_data = this.process_order_data.bind(this);\n    this.process_order_state = this.process_order_state.bind(this);\n    this.process_finished_data = this.process_finished_data.bind(this);\n    this.process_finished_state = this.process_finished_state.bind(this);\n\n    this.process_card_details = this.process_card_details.bind(this);\n    this.process_enemy_details = this.process_enemy_details.bind(this);\n    this.process_order_details = this.process_order_details.bind(this);\n\n    this.wrap_controller_action = this.wrap_controller_action.bind(this);\n    this.set_branch = this.set_branch.bind(this);\n    this.check_card = this.check_card.bind(this);\n\n    this.play_card = this.play_card.bind(this);\n    this.use_mine = this.use_mine.bind(this);\n    this.use_fight = this.use_fight.bind(this);\n    this.finish_order = this.finish_order.bind(this);\n    this.use_order = this.use_order.bind(this);\n\n    this.render_game_board = this.render_game_board.bind(this);\n    this.render_tag_board = this.render_tag_board.bind(this);\n    this.render_deck_board = this.render_deck_board.bind(this);\n    this.render_card_board = this.render_card_board.bind(this);\n\n    this.change_board = this.change_board.bind(this);\n    this.choose_tag = this.choose_tag.bind(this);\n    this.get_risk_level = this.get_risk_level.bind(this);\n    this.enter_game = this.enter_game.bind(this);\n\n    this.state = {\n      hand_selected: -1,\n      field_selected: -1,\n      efield_selected: -1,\n      order_selected: -1,\n      finished_selected: -1,\n\n      branch: {},\n      show_field: true,\n      show_tag_selection: false,\n\n      stage: \"player\",\n\n      board: this.render_tag_board, //function or string here?\n\n      tags: TAGS,\n      risk_level: 0, // this is changed on game begin\n      deck_data: default_deck,\n\n      checking: {},\n\n      scenario_finished: false,\n    };\n\n    this.branches = { // TODO: set all \"check\" aside to the right, this is not done using Controller, first set the width of controller, then add a new button on render_board\n      hand: {\n        部署: this.play_card,\n        查看: this.check_card,\n      },\n      field: {\n        采掘: this.use_mine,\n        战斗: this.use_fight,\n        查看: this.check_card,\n      },\n      efield: {\n        战斗: this.use_fight,\n        查看: this.check_card,\n      },\n      orders: {\n        完成: this.finish_order,\n        查看: this.check_card,\n      },\n      finished: {\n        行动: this.use_order,\n        查看: this.check_card,\n      },\n    };\n\n    this.log_select = () => ((this.props.G.messages[0].includes(\"选定\")? this.props.moves.changeMsg : this.props.moves.logMsg));\n  }\n\n  choose_tag(idx) {\n    return () => {\n      let new_tags = this.state.tags;\n      new_tags[idx].selected = !new_tags[idx].selected;\n      this.setState({tags: new_tags});\n    };\n  }\n\n  get_risk_level() {\n    let selected_tags = this.state.tags.filter(t => t.selected);\n    let reducer = (acc, val) => (acc + val.level);\n    let risk_level = selected_tags.reduce(reducer, 0);\n    return risk_level;\n  }\n  \n  check_card() {\n    this.change_board(\"card\");\n    return this.state.branch;\n  }\n\n  play_card() {\n    this.props.moves.play(this.state.hand_selected);\n    this.setState({hand_selected: -1});\n    return {};\n  }\n  \n  use_mine() {\n    this.props.moves.mine(this.state.field_selected);\n    this.setState({field_selected: -1});\n    return {};\n  }\n\n  use_fight() {\n    this.props.moves.fight(this.state.field_selected, this.state.efield_selected);\n    this.setState({\n      field_selected: -1,\n      efield_selected: -1,\n    });\n    return {};\n  }\n\n  finish_order() {\n    this.props.moves.finishOrder(this.state.order_selected);\n    this.setState({order_selected: -1});\n    return {};\n  }\n\n  use_order() {\n    this.props.moves.useOrder(this.state.finished_selected);\n    this.setState({finished_selected: -1});\n    return {};\n  }\n  \n  process_hand_data(card) {\n    return {\n      illust: card.illust,\n      atk: card.atk,\n      hp: card.hp,\n      cost: card.cost,\n    };\n  }\n\n  process_hand_state(card) {\n    return {\n      selected: (this.state.hand_selected == this.props.G.hand.indexOf(card)),\n    }\n  }\n  \n  process_field_data(card) {\n    let data = {\n      illust: card.illust,\n      atk: card.atk,\n      hp: (card.hp - card.dmg),\n      mine: (<span>{ICONS.mine}{card.mine}</span>),\n    };\n    if (card.block > 0) {\n      data.block = (<span>{ICONS.block}{card.block}</span>);\n    }\n    return data;\n  }\n\n  process_field_state(card) {\n    return {\n      selected: (this.state.field_selected == this.props.G.field.indexOf(card)),\n      exhausted: card.exhausted, \n      damaged: (card.dmg > 0),\n    }\n  }\n\n  process_efield_data(card) {\n    return {\n      e_illust: card.illust,\n      atk: card.atk,\n      hp: (card.hp - card.dmg),\n      //cost: card.cost,\n    };\n  }\n\n  process_efield_state(card) {\n    return {\n      selected: (this.state.efield_selected == this.props.G.efield.indexOf(card)),\n      exhausted: card.exhausted, \n      damaged: (card.dmg > 0),\n    }\n  }\n\n  process_order_data(card) {\n    //EH: reconstruct this\n    let requirements = [];\n    for (let i=0; i<3; i++) {\n      let icon = ICONS[Object.keys(ICONS)[i]];\n      let amount = card.requirements[i];\n      for (let j=0; j<amount; j++) {\n        requirements.push(icon);\n      }\n    }\n    return {\n      o_illust: \"https://ak.hypergryph.com/upload/images/20190228/32ddf0470a305376204d1312ca4720f9.jpg\",\n      requirements: requirements,\n      score: card.score,\n      reward: material_icons[card.reward],\n      order_effect: card.desc,\n    };\n  }\n\n  process_order_state(card) {\n    return {\n      selected: (this.state.order_selected == this.props.G.orders.indexOf(card)),\n      exhausted: card.exhausted, \n    }\n\n  }\n\n  process_finished_data(card) {\n    return {\n      o_illust: order_illust,\n      finished_effect: card.desc,\n    };\n  }\n\n  process_finished_state(card) {\n    return {\n      selected: (this.state.finished_selected == this.props.G.finished.indexOf(card)),\n      exhausted: card.exhausted, \n    }\n  }\n\n  process_card_details(card) {\n    return {\n      illust_detailed: card.illust,\n      cost_detailed: card.cost,\n      desc: (\n        <span>\n          {card.atk}/{card.hp} &nbsp;\n          {ICONS.mine}{card.mine} &nbsp;\n          {(card.block>0)? (<span>{ICONS.block}{card.block}</span>) : \"\"}\n          <br/>\n          {card.desc||\"\"}\n        </span>\n      ), // TODO: figure out why only string formatting does not work, I think it maybe because of JSX only accept string in html way instead of js way\n    }\n  }\n\n  process_enemy_details(card) {\n    return {\n      eo_illust_detailed: card.illust,\n      desc: (\n        <span>\n          {card.atk}/{card.hp}\n          <br/>\n          {card.desc||\"\"}\n        </span>\n      ),\n    }\n  }\n\n  process_order_details(card) {\n    return {\n      eo_illust_detailed: order_illust,\n      desc: card.desc,\n    };\n  }\n\n  enemy_move(i) {\n    if (i < this.props.G.efield.length) {\n      this.setState({stage: \"enemy\"});\n      let sleep_time = 350;\n      if (i < 0) {\n        this.props.moves.drawEnemy(); // start from -2 to draw 2 enemies\n      }\n      else {\n        if (this.props.G.efield[i].exhausted) {\n          sleep_time = 50;\n        }\n        this.props.moves.enemyMove(i);\n      }\n      sleep(sleep_time).then(() => {this.enemy_move(i+1);});\n    }\n    else{\n      this.props.events.endTurn();\n      this.setState({stage:\"player\"});\n    }\n  }\n\n  handle_hand_clicked(idx) {\n    let card = this.props.G.hand[idx];\n    return () => {\n      this.setState({\n        hand_selected: idx,\n        checking: this.process_card_details(card),\n      });\n      this.set_branch(\"hand\");\n      this.log_select()(\"选定 \"+card.name);\n    };\n  }\n\n  handle_field_clicked(idx) {\n    let card = this.props.G.field[idx];\n    return () => {\n      this.setState({\n        field_selected: idx,\n        checking: this.process_card_details(card),\n      });\n      this.set_branch(\"field\");\n      this.log_select()(\"选定 \"+card.name);\n      //TODO: add \"action\" and \"reinfoce\" in current branch at here\n    };\n  }\n\n  handle_efield_clicked(idx) {\n    let card = this.props.G.efield[idx];\n    return () => {\n      this.setState({\n        efield_selected: idx,\n        checking: this.process_enemy_details(card),\n      });\n      this.set_branch(\"efield\");\n      this.log_select()(\"选定 \"+card.name);\n    };\n  }\n\n  handle_order_clicked(idx) {\n    let card = this.props.G.orders[idx];\n    return () => {\n      this.setState({\n        order_selected: idx,\n        checking: this.process_order_details(card),\n      });\n      this.set_branch(\"orders\");\n      this.log_select()(\"选定订单\");\n    };\n  }\n\n  handle_finished_clicked(idx) {\n    let card = this.props.G.finished[idx];\n    return () => {\n      this.setState({\n        finished_selected: idx,\n        checking: this.process_order_details(card),\n      });\n      this.set_branch(\"finished\");\n      this.log_select()(\"选定订单\");\n    };\n  }\n\n  handle_deck_change(event) {\n    this.setState(\n      {deck_data: event.target.value}\n    );\n  }\n\n  wrap_controller_action(action) {\n    return () => {this.set_branch(action())};\n  }\n\n  set_branch(branch) {\n    if (typeof branch == \"string\") {\n        this.setState({\n          branch: map_object(this.wrap_controller_action, this.branches[branch])\n        });\n    }\n    else {\n      this.setState({branch: map_object(this.wrap_controller_action, branch)});\n    }\n\n  }\n\n  change_board(new_board) {\n    const boards = {\n      \"game\": this.render_game_board,\n      \"tag\": this.render_tag_board,\n      \"deck\": this.render_deck_board,\n      \"card\": this.render_card_board,\n    };\n    this.setState({board: boards[new_board]});\n  }\n\n  enter_game() {\n    this.props.moves.setDeck(this.state.deck_data);\n    this.props.moves.addTags(this.state.tags.filter(t => t.selected));\n    this.props.moves.onScenarioBegin();\n    this.change_board(\"game\");\n  }\n\n  end_game() {\n    this.props.reset();\n    this.setState({scenario_finished: false});\n    this.change_board(\"tag\");\n  }\n\n  componentDidUpdate() {\n    let result = this.props.ctx.gameover;\n    if (result && !this.state.scenario_finished) {\n      this.setState({scenario_finished: true});\n\n      if (result.win) {\n        let risk_level = this.get_risk_level();\n        let grade = \"D\";\n        // TODO: reconstruct this using \"range\" function\n        if (risk_level >= 0 && risk_level < 2) {\n          grade = \"C\";\n        }\n        else if (risk_level >= 2 && risk_level < 4) {\n          grade = \"B\";\n        }\n        else if (risk_level >= 4 && risk_level < 6) {\n          grade = \"A\";\n        }\n        else if (risk_level >= 6 && risk_level < 8) {\n          grade = \"S\";\n        }\n        else if (risk_level >= 8 && risk_level < 10) {\n          grade = \"SS\";\n        }\n        else {\n          grade = \"SSS\";\n        }\n        alert(`任务完成\\n完成危机等级: ${risk_level}\\n评级: ${grade}`);\n      }\n\n      else {\n        alert(`任务失败\\n原因: ${result.reason}`);\n\n      }\n\n    }\n  }\n\n  render_game_board() {\n    // EH: map object in state changing and store the mapped object in state\n\n    // SR: player panel\n    // TODO: reconstruct this, this is stateful, and html elements should go to stateless\n    let material_display = (idx) => (\n      <span style={{color:(this.props.G.gained.includes(idx))?\"blue\":\"black\"}}>\n        {material_icons[idx]}:{this.props.G.materials[idx]}&nbsp;&nbsp;&nbsp; \n      </span>\n    );\n\n    let player_panel = (<div>\n      <p style={{marginTop:\"2%\"}}>\n        {[0,1,2,3].map(material_display)}\n        费用: {this.props.G.costs}  \n        <br/>\n        <button \n          className=\"player-panel-button\"\n          onClick={() => {this.setState({show_field: !this.state.show_field})}}\n        >\n          {(this.state.show_field)? \"查看订单\" : \"查看战场\"}\n        </button>\n        <button \n          className=\"player-panel-button\"\n          style={{\n            display: (this.state.stage==\"enemy\")? \"none\" : \"\"\n          }} \n          onClick={()=>{this.enemy_move(-2);}}\n        >\n          结束回合\n        </button>\n        <button \n          className=\"player-panel-button\"\n          style={{\n            display: (this.props.ctx.gameover)? \"\" : \"none\"\n          }} \n          onClick={()=>{this.end_game();}}\n        >\n          结束游戏\n        </button>\n      </p>\n    </div>);\n\n    //SR: game panel and debug the <p> and maybe get all styles out of this\n    //And learn about the diff between span and p\n    let game_panel = (<div>\n      <p style={{marginTop: \"0%\"}}>\n        动乱:{this.props.G.danger}/{this.props.G.max_danger} &nbsp;&nbsp;&nbsp;\n        分数:{this.props.G.score}/{this.props.G.goal}<br/>\n        <span onClick={()=>{alert(this.props.G.messages.slice(0,20).join(\"\\n\"));}}>{this.props.G.messages[0]}</span>\n      </p>\n    </div>);\n\n    let field_cardrow = (\n      <CardRow \n        cards = {this.props.G.field.map(this.process_field_data)}\n        states = {this.props.G.field.map(this.process_field_state)}\n        handleClick = {this.handle_field_clicked}\n      />\n    );\n\n    let hand_cardrow = (\n      <CardRow\n          cards = {this.props.G.hand.map(this.process_hand_data)}\n          states = {this.props.G.hand.map(this.process_hand_state)}\n          handleClick = {this.handle_hand_clicked}\n        />\n    );\n\n    let orders_cardrow = (\n      <CardRow \n        cards = {this.props.G.orders.map(this.process_order_data)}\n        states = {this.props.G.orders.map(this.process_order_state)}\n        handleClick = {this.handle_order_clicked}\n      />\n    );\n\n    let finished_cardrow = (\n      <CardRow \n        cards = {this.props.G.finished.map(this.process_finished_data)}\n        states = {this.props.G.finished.map(this.process_finished_state)}\n        handleClick = {this.handle_finished_clicked}\n      />\n    );\n\n    return (\n      <div className=\"board\" >\n        <Panel \n          variant = \"game-panel\"\n          content = {game_panel}\n        />\n        <CardRow \n          cards = {this.props.G.efield.map(this.process_efield_data)}\n          states = {this.props.G.efield.map(this.process_efield_state)}\n          handleClick = {this.handle_efield_clicked}\n        />\n        {(this.state.show_field)? field_cardrow : finished_cardrow}\n        <Controller \n          actions = {this.state.branch}\n        />\n        {(this.state.show_field)? hand_cardrow : orders_cardrow}\n        <Panel \n          variant = \"player-panel\"\n          content = {player_panel}\n        />\n\n      </div>\n    );\n  }\n\n  render_card_board() {\n    return (\n      <div className=\"board\" align=\"center\">\n        <CardDetailed \n          card={this.state.checking} \n          handleClick={()=>this.change_board(\"game\")} \n        />\n      </div>\n    );\n\n  }\n\n  render_tag_board() {\n    let risk_level = this.get_risk_level();\n\n    return (\n      <div className=\"board\" >\n        <TagSelection \n          tags = {this.state.tags}\n          handleClick = {this.choose_tag}\n        />\n        <TagList \n          selected_tags = {this.state.tags.filter(t => t.selected)}\n        />\n        <RiskLevel \n          risk_level = {risk_level}\n        />\n        <br/>\n        <div \n          style={{\n            color: \"red\", \n            marginLeft: \"2%\",\n            marginTop: \"-3%\",\n            display:(risk_level>=5)? \"\" : \"none\"\n          }}\n        >\n          当前合约难度极大，请谨慎行动\n        </div>\n        \n        <EnterGame \n          switchScene = {() => {this.change_board(\"deck\")}}\n          switchText = \"查看卡组\"\n          enterGame = {() => {this.enter_game()}}\n        />\n\n        \n      </div>\n    );\n  }\n\n  render_deck_board() {\n    return (\n      <div className=\"board\" >\n        <DeckConstruction\n          value = {this.state.deck_data}\n          handleChange = {this.handle_deck_change}\n        />\n        <EnterGame \n          switchScene = {() => {this.change_board(\"tag\")}}\n          switchText = \"查看词条\"\n          enterGame = {() => {this.enter_game()}}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    return this.state.board(); \n  }\n}","import { Client } from 'boardgame.io/react';\nimport { AC } from './Game';\nimport { Board } from './Board';\n\nconst App = Client({ \n  game: AC, \n  board: Board,\n  debug: false,\n});\n\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n    <App />\n  ,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA"],"sourceRoot":""}